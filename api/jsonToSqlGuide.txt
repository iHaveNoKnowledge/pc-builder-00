••••Add Json to SQL••••
src : https://database.guide/how-to-import-a-json-file-into-a-sql-server-table/
SELECT items.* FROM OPENROWSET (
	BULK 'D:\pratchaya\server\json_files\db.json',
	SINGLE_CLOB) AS [Json]
	CROSS APPLY OPENJSON (BulkColumn,'$.items2')
	WITH (
		code varchar(50),
		productDescription varchar(50) '$.description',
		title varchar(100),
		category varchar(50)
	) AS [items]

--items.*(row1) itemsมันมาจากrow10
--OPENROWSET() BULK เลือกไฟล์จาก path ซึ่งใน path ก็เป็น Json อยู่แล้วจะAS [Json] ทำไมไม่รู้ 
--CROSS APPLY OPENJSON (BulkColumn,'$.items2')  เป็นการเข้าถึงค่าแบบ object notation
--(LINE7-12) : WITH() บรรทัด 9 productDescription varchar(50)
 --productDescription varchar(50)  = ชื่อคอลลั่มที่จะสร้างใหม่และ datatype(ขนาดเซล)  
 --'$.description' = เลือกค่าจากตัวแปรภายใต้ items2  

 ใช้ได้แล้ว
 INSERT INTO TEST_PRODUCTS (code, productDescription, title, category, countITEM, socket, typeRam, slot, img, srp, promotionPrice, compatible, bus, capaPerRam, totalCapa, effect, latency, color, chipset, formFactor, cpuSeries,  pcieGen, maxBus, series, model, brand, qty)
SELECT item['code'], item['productDescription'], item['title'], item['category'], item['count'], item['socket'], item['slot'], item['img'], item['srp'], item["promotionPrice"], item["compatible"], item["bus"], item["capaPerRam"], item["totalCapa"], item["effect"], item["latency"], item["color"], item["chipset"], item["formFactor"], item["cpuSeries"], item["pcieGen"], item["maxBus"], item["series"], item["model"], item["brand"], item["qty"]
FROM OPENROWSET (
    BULK 'D:\pratchaya\server\json_files\db.json',
    SINGLE_CLOB) AS [Json]
CROSS APPLY OPENJSON (BulkColumn,'$.items2')
WITH (
    code varchar(50),
    productDescription varchar(MAX) '$.description',
    title varchar(100),
    category varchar(50)
) AS [items];


//// แบบเติมยังไม่ครบ

INSERT INTO TEST_PRODUCTS (code, productDescription, title, category, countItem, socket, typeRam, slot, img, srp, promotionPrice, compatible, bus, capaPerRam, totalCapa, effect, latency, color, chipset, formFactor, cpuSeries,  pcieGen, maxBus, series, model, brand, qty)
SELECT [item].code, [item].productDescription, [item].title, [item].category, [item].countItem, [item].socket, [item].typeRam, [item].slot, [item].img, [item].srp, [item].promotionPrice, [item].compatible, [item].bus, [item].capaPerRam, [item].totalCapa, [item].effect, [item].latency, [item].color, [item].chipset, [item].formFactor, [item].cpuSeries, [item].pcieGen, [item].maxBus, [item].series, [item].model, [item].brand, [item].qty
FROM OPENROWSET (
    BULK 'D:\pratchaya\server\json_files\db.json',
    SINGLE_CLOB) AS [Json]
CROSS APPLY OPENJSON (BulkColumn,'$.items2')
WITH (
    code varchar(50),
    productDescription varchar(MAX) '$.description',
    title varchar(100),
    category varchar(50),
	countItem int '$.count',
	socket varchar(50),
	typeRam varchar(6),
	slot int,
	img varbinary(max),
	srp decimal(10, 2),
	promotionPrice decimal(10, 2),
	compatible varchar(50),
	bus varchar(50),
	capaPerRam varchar(50),
	totalCapa varchar(50),
	effect varchar(50),
	latency varchar(50),
	color varchar(50),
	chipset varchar(50),
	formFactor varchar(50),
	cpuSeries varchar(50),
	pcieGen varchar(50),
	maxBus varchar(50)

) AS [items];

ตัวนี้ใช้ได้ 19/06/2023 อันที่แล้วพังเพราะ ชื่อตารางไม่ตรงกับไฟล์ JSON ที่ import เข้ามา
INSERT INTO TEST_PRODUCTS (code, productDescription, title, category, countItem, socket, typeRam, slot, img, srp, promotionPrice, compatible, bus, capacityPerRAM, totalCapacity, effect, latency, color, chipset, formFactor, cpuSeries,  pcieGen, maxBus, series, model, brand, qty)
SELECT [items].code, [items].productDescription, [items].title, [items].category, [items].countItem, [items].socket, [items].typeRam, [items].slot, [items].img, [items].srp, [items].promotionPrice, [items].compatible, [items].bus, [items].capacityPerRAM, [items].totalCapacity, [items].effect, [items].latency, [items].color, [items].chipset, [items].formFactor, [items].cpuSeries, [items].pcieGen, [items].maxBus, [items].series, [items].model, [items].brand, [items].qty
FROM OPENROWSET (
    BULK 'D:\pratchaya\server\json_files\db.json',
    SINGLE_CLOB) AS [Json]
CROSS APPLY OPENJSON (BulkColumn,'$.items2')
WITH (
    code varchar(50),
    productDescription varchar(MAX) '$.description',
    title varchar(100),
    category varchar(50),
	countItem int '$.count',
	socket varchar(50),
	typeRam varchar(6) '$.typeRAM',
	slot int,
	img varchar(max),
	srp decimal(10, 2),
	promotionPrice decimal(10, 2),
	compatible varchar(50) '$.for',
	bus varchar(50),
	capacityPerRAM varchar(50) ,
	totalCapacity varchar(50),
	effect varchar(50),
	latency varchar(50),
	color varchar(50),
	chipset varchar(50),
	formFactor varchar(50),
	cpuSeries varchar(50),
	pcieGen varchar(50),
	maxBus varchar(50),
	series varchar(max),
	model varchar(100),
	brand varchar(100),
	qty int
) AS [items];

ตัวอย่างสำหรับใช้ post request ผ่าน nodejs Express 
router.post("/create-set", (req, res) => {
  const { field1 } = req.body;

  const query = `
  BEGIN TRANSACTION;

  DECLARE @mainTableId INT;
  INSERT INTO MainTable (Field1) VALUES (@xx);
  SET @mainTableId = SCOPE_IDENTITY();
  SELECT * FROM MainTable WHERE MainTableID = @mainTableId;

  COMMIT TRANSACTION;
`;

  sql.connect(config_3, (err) => {
    if (err) {
      console.log(err);
      res.statusMessage(500).send("Error connecting to the DB");
      return;
    }

    const request = new sql.Request();
    request.input("xx", sql.VarChar, field1);
    request.query(query, (err, yy) => {
      if (err) {
        console.log(err);
        res.status(500).send("Error inserting data into the tables.");
        return;
      }

      res.status(200).json(yy);
    });
  });
});


json table ตารางแบบ JSON  ยังไม่ได้ลองสร้าง หมดเวลาสะก่อน
DECLARE @json NVARCHAR(MAX) = '{
  "id": 3,
  "timeStamp": "May 19 2023, 5:13:37 pm",
  "setName": "Setหย่อสูตรต่อ",
  "customerName": "ลุงตู่",
  "customerTel": "032323232",
  "salerName":"ไอ้ปื้ด",
  "salerTel":"0853232323",
  "partData": [
    {
      "category": "CPU",
      "typeMax": 1,
      "typeAmount": 0,
      "listItems": [
        {
          "id": 1,
          "code": "CU2-000009",
          "productDescription": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque non eros dapibus, maximus tellus sollicitudin, iaculis ligula. Nullam ullamcorper metus sit amet orci consectetur interdum. Aliquam nec erat congue, facilisis.",
          "title": "CPU01_AMD",
          "category": "CPU",
          "countItem": null,
          "socket": "AM4",
          "typeRam": null,
          "slot": null,
          "img": "https://media-cdn.bnn.in.th/263562/730143309936-00-square_medium.jpg",
          "srp": 19290,
          "promotionPrice": 9066,
          "compatible": null,
          "bus": null,
          "capacityPerRAM": null,
          "totalCapacity": null,
          "effect": null,
          "latency": null,
          "color": null,
          "chipset": null,
          "formFactor": null,
          "cpuSeries": null,
          "pcieGen": null,
          "maxBus": null,
          "series": "AMD Ryzen 3000 Series",
          "model": "Ryzen 5",
          "brand": "AMD",
          "qty": 1,
          "selectAmount": 1
        }
      ]
    },
    {
      "category": "Mainboard",
      "typeMax": 1,
      "typeAmount": 0,
      "listItems": [
        {
          "id": 5,
          "code": "CR4-000014",
          "productDescription": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque non eros dapibus, maximus tellus sollicitudin, iaculis ligula.",
          "title": "Mainboard01_AMD",
          "category": "Mainboard",
          "countItem": null,
          "socket": "AM4",
          "typeRam": "DDR4",
          "slot": 2,
          "img": "https://media-cdn.bnn.in.th/19033/Asus-Mainboard-PRIME-A320M-K-DDR4-AM4-1-square_medium.jpg",
          "srp": 10560,
          "promotionPrice": 1690,
          "compatible": "AMD",
          "bus": null,
          "capacityPerRAM": null,
          "totalCapacity": null,
          "effect": null,
          "latency": null,
          "color": null,
          "chipset": "AMD A320",
          "formFactor": "Micro-ATX",
          "cpuSeries": "AMD Ryzen 2000, 3000 Series Desktop Processors",
          "pcieGen": "1 x PCIe 3.0 x16 Slot , 2 x PCIe 2.0 x1 Slots",
          "maxBus": "DDR4 Support up to 3200(OC) MHz",
          "series": null,
          "model": null,
          "brand": "brandex1",
          "qty": 1,
          "selectAmount": 1
        }
      ]
    },
    {
      "category": "RAM",
      "typeMax": 4,
      "typeAmount": 0,
      "listItems": [
        {
          "id": 13,
          "code": "ME1-000022",
          "productDescription": "Lorem ipsum dolor sit amet, consectetur adipiscing elit.",
          "title": "RAM01_single",
          "category": "RAM",
          "countItem": 1,
          "socket": null,
          "typeRam": "DDR4",
          "slot": null,
          "img": "https://media-cdn.bnn.in.th/106735/zadak-moab-aura2-rgb-ddr4-1-square_medium.jpg",
          "srp": 7460,
          "promotionPrice": 3655,
          "compatible": "PC",
          "bus": "2666 MHz",
          "capacityPerRAM": "8 GB",
          "totalCapacity": "8 GB",
          "effect": "RGB",
          "latency": "16-18-18-38",
          "color": "Black",
          "chipset": null,
          "formFactor": null,
          "cpuSeries": null,
          "pcieGen": null,
          "maxBus": null,
          "series": null,
          "model": null,
          "brand": "Zadak",
          "qty": 1,
          "selectAmount": 2
        }
      ]
    }
  ]
}';

SELECT *
INTO YourTableName
FROM OPENJSON(@json) WITH (
  id INT '$.id',
  timeStamp NVARCHAR(50) '$.timeStamp',
  setName NVARCHAR(50) '$.setName',
  customerName NVARCHAR(50) '$.customerName',
  customerTel NVARCHAR(50) '$.customerTel',
  salerName NVARCHAR(50) '$.salerName',
  salerTel NVARCHAR(50) '$.salerTel',
  partData NVARCHAR(MAX) '$.partData' AS JSON
);
